<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Guestbook - Von Francisco</title>
  <link rel="stylesheet" href="style.css">

  <!-- Vue -->
  <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>

  <!-- Supabase -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
</head>

<body>
  <div id="loader">
    <div class="loader-text">LOADING...</div>
  </div>

  <div class="city-overlay" aria-hidden="true"></div>
  <canvas id="particles" aria-hidden="true"></canvas>

  <nav>
    <div class="menu-toggle" onclick="toggleMenu()">â˜°</div>
    <div><strong>VON FRANCISCO</strong></div>
    <div class="nav-links">
      <a href="index.html">Home</a>
      <a href="about.html">About</a>
      <a href="guestbook.html">Guestbook</a>
      <a href="playground.html">Playground</a>
    </div>
  </nav>

  <div id="app" class="page">
    <div class="container">
      <h1>Guestbook</h1>

      <input v-model="name" placeholder="Your name">
      <textarea v-model="message" placeholder="Your message"></textarea>
      <button @click="addComment">Post Comment</button>

      <div v-for="comment in comments" :key="comment.id" class="comment">
        <strong>{{ comment.name }}</strong>
        <p>{{ comment.message }}</p>
      </div>
    </div>
  </div>

  <script>
  const { createApp, ref, onMounted } = Vue
  const { createClient } = supabase

  const db = createClient(
    'https://cdrhbihdnvqkcixqqvad.supabase.co',
    'sb_publishable_yNAeLHsCJIw3rUPUMy8A-w_kJ4xx3Lk'
  )

  createApp({
    setup() {
      const name = ref('')
      const message = ref('')
      const comments = ref([])

      async function fetchComments() {
        const { data } = await db.from('guestbook').select('*').order('created_at', { ascending: false })
        comments.value = data || []
      }

      async function addComment() {
        if (!name.value || !message.value) return
        await db.from('guestbook').insert([{ name: name.value, message: message.value }])
        name.value = ''
        message.value = ''
        fetchComments()
      }

      onMounted(fetchComments)
      return { name, message, comments, addComment }
    }
  }).mount('#app')

  // Particles
  const canvas = document.getElementById('particles')
  const ctx = canvas && canvas.getContext ? canvas.getContext('2d') : null
  if (ctx) {
    canvas.width = window.innerWidth
    canvas.height = window.innerHeight
    let particles = []
    for (let i = 0; i < 120; i++) particles.push({ x: Math.random()*canvas.width, y: Math.random()*canvas.height, size: Math.random()*2, speed: Math.random()*0.6 })
    function animate() {
      ctx.clearRect(0,0,canvas.width,canvas.height)
      particles.forEach(p => {
        ctx.fillStyle = 'rgba(0,240,255,0.8)'
        ctx.beginPath(); ctx.arc(p.x,p.y,p.size,0,Math.PI*2); ctx.fill()
        p.y -= p.speed; if (p.y < 0) p.y = canvas.height
      })
      requestAnimationFrame(animate)
    }
    animate()
  }

  // Behavior: transitions, loader, menu
  document.querySelectorAll('a[href$=".html"]').forEach(link => link.addEventListener('click', function(e){ e.preventDefault(); document.body.classList.add('fade-out'); setTimeout(()=> window.location.href = this.href,300)}))
  window.addEventListener('load', ()=>{ const loader = document.getElementById('loader'); if(loader){ loader.style.opacity='0'; setTimeout(()=>loader.remove(),500)} })
  function toggleMenu(){ document.querySelector('.nav-links').classList.toggle('show') }
  </script>

</body>
</html>